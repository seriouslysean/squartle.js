/**
 * Splitleaf_Squartle
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the MIT LICENSE
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/MIT
 *
 * @category   Splitleaf
 * @package    Splitleaf_Squartle
 * @copyright  Copyright 2013 Splitleaf, LLC
 * @license    http://opensource.org/licenses/MIT
 * @author     Sean Kennedy <sean@splitleaf.net>
 * @version    1.0.0
 */
(function(e,t,n,r){function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="squartle";var s={containerClass:"squartle-container",containerMaxWidth:"100%",containerMinWidth:"0",heroEnable:true,heroContainerClass:"squartle-heroes",heroClass:"squartle-hero",heroDefault:0,videoContainerClass:"squartle-videos",videoClass:"squartle-video",videoCustomSelector:false,listClass:"squartle-items",itemsAcross:3,itemClass:"squartle-item",linkClass:"squartle-link",imageClass:"squartle-image",imageHoverClass:"squartle-image-hover",beforeInit:function(){},onLinkClick:function(){},afterInit:function(){}};o.prototype={init:function(){this._setupOptions(this.element,this.options);this.options.beforeInit.call(this.element);this._setupElements(this.element,this.options);this._setupStyles(this.element,this.options);this._setupHover(this.element,this.options);this._setupClick(this.element,this.options);this.options.afterInit.call(this.element)},_setupOptions:function(t,n){this.options.hasHeroes=e("> ul > li > div",t).length?true:false;if(!this.options.hasHeroes)this.options.heroEnable=false},_setupElements:function(t,n){if(n.heroEnable){heroesContainer=e("<div>").addClass(n.heroContainerClass);e(t).prepend(heroesContainer)}e("li",t).each(function(){e("img",this).addClass(n.imageClass);e("> a",this).addClass(n.linkClass);e(this).addClass(n.itemClass);e(this).parentsUntil(t,"ul").addClass(n.listClass);if(e("> a",this).data("hover")){hover=e("<img>").attr({src:e("> a",this).data("hover")}).addClass(n.imageHoverClass);e("> a",this).append(hover)}if(n.heroEnable){heroes=e("> div",e(this).not(".no-hero")).addClass(n.heroClass);e(heroes).each(function(){e(this).attr("id",n.heroClass+"-"+e(this).parents("li").index());var t=["iframe[src*='player.vimeo.com']","iframe[src*='youtube.com']","iframe[src*='youtube-nocookie.com']","iframe[src*='kickstarter.com'][src*='video.html']","object","embed"];if(n.videoCustomSelector)t.push(n.videoCustomSelector);heroVideos=e(this).find(t.join(",")).not("object object");e(heroVideos).each(function(){heroVideos=e("<div>").addClass(n.videoContainerClass);e(this).addClass(n.videoClass).wrap(heroVideos)})});e("> div",t).append(heroes)}})},_setupStyles:function(t,n){e(t).css({"font-size":"100%","max-width":n.containerMaxWidth,"min-width":n.containerMinWidth,overflow:"hidden",width:"100%"});e("."+n.heroContainerClass,t).css({position:"relative",height:"auto",overflow:"hidden"});e("."+n.heroClass,t).css({position:"absolute","float":"none",height:"auto",top:"0",left:"0","z-index":0,opacity:0,overflow:"hidden"});e("."+n.videoContainerClass,t).css({width:"100%",height:"0"});videos=e("."+n.videoClass,t);e(videos).each(function(){aspectRatio=e(this).height()/e(this).width();e(this).parent().css("padding","0 0 "+aspectRatio*100+"% 0");e(this).css({top:0,left:0,width:"100%",height:"100%"})});e("."+n.listClass).css("display","inline");width=100/n.itemsAcross;e("."+n.itemClass,t).css({overflow:"hidden","float":"left",display:"block",position:"relative",width:width+"%"});e("."+n.itemClass,t).css("height",e("."+n.itemClass,t).not(".no-hero").width());e("."+n.linkClass).css("display","inline");e("."+n.imageClass,t).css({display:"block",height:"auto","max-width":"100%",width:"100%"});e("."+n.imageHoverClass,t).css({display:"none",height:"auto","max-width":"100%",width:"100%",position:"absolute",top:"0",left:"0","z-index":"10"})},_setupHover:function(t,n){if(e("."+n.linkClass,t).length){e("."+n.linkClass,t).each(function(){e(this).hover(function(t){t.preventDefault();if(!e(this).hasClass("active"))e("> ."+n.imageHoverClass,this).finish().fadeIn("fast")},function(t){t.preventDefault();if(!e(this).hasClass("active"))e("> ."+n.imageHoverClass,this).finish().fadeOut("fast")})})}},_setupClick:function(t,n){e("."+n.linkClass,t).click(function(r){r.preventDefault();notActive=e("> a",e(this).parent().siblings().not(e(this).parent()));notActive.removeClass("active");e("> ."+n.imageHoverClass,notActive).finish().fadeOut("fast");e(this).addClass("active");e("> ."+n.imageHoverClass,this).finish().fadeIn("fast");if(n.heroEnable){hero=e("#"+n.heroClass+"-"+e(this).parent().index()+"."+n.heroClass,t);heroAll=e("."+n.heroClass,t);heroNotActive=e("."+n.heroClass,t).not(hero);e(heroAll).removeClass("active").css({position:"absolute","float":"left"}).animate({"z-index":0,opacity:0},{duration:"fast",queue:false});e(hero).addClass("active").css({position:"relative","float":"none"}).animate({"z-index":10,opacity:1},{duration:"fast",queue:false,complete:function(){e("html,body").animate({scrollTop:e(t).offset().top})}})}n.onLinkClick.call(this,t,n)});if(n.heroEnable){defaultHero=e("."+n.itemClass+":eq("+n.heroDefault+")",t);e("> ."+n.linkClass,defaultHero).click()}},_setupResize:function(n,r){e(t).resize(function(){e("."+r.itemClass,n).css("height",e("."+r.itemClass,n).not(".no-hero").width())})}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)